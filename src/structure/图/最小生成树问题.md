# 最小生成树

啥叫生成树？在一个连通的无向图里（既然是连通的了，那就是任意两个节点之间都能有一条路径可以到达），从图的边集合里找出一个这样的集合，它能连接起所有的点，并且是 n-1 条边。因为总共 n 个顶点，需要 n-1 条边将他们连接起来。这个边的集合和顶点集合就是生成树 

> 生成树可能不唯一

在一个**有权无向的连通图**里，希望得出这样一个边的集合：它的所有的边都是原图 G.E 中的边，通过这些边它能将原图 G.V 中所有的节点连接起来，并且边的权值和是各种方案里最小的。

怎么生成这么一个树呢？

我们采用贪心策略去实施循环，假定有一个集合 A ，在每次循环之前，A 都是最小生成树的子集。在每次循环的过程中，我们找出一条边 (u,v)， 要满足这条边加入 A 之后仍然能保证 A 是最小生成树的子集，那么当把所有的顶点都包含在树中时，循环结束，最后的集合 A 就是要找的最小生成树的边的关系。（A 是边的集合，最小生成树是顶点和边的关系集合，所以 A 并不是最小生成树，但我们依然叫 A 是最小生成树，是因为要求的最小生成树的顶点是确定的，就是图 G.V 里的所有顶点，所以如果能确定这些顶点的边关系，就确定了最小生成树。所以通过 A 就确定了树，所以就把 A 叫做树，为了方便）

```
A = ∅
while (A does not form a spanning tree) {
  find an edge (u,v) that is safe for A
  A = A ∪ { (u,v) }
}
return A
```

对于初始状态，集合 A 是个空集，空集是任何集合的子集，所以初始状态能保证 A 是最小生成树的子集，如果能证明 while 循环之后，确实能维持这条性质不变，那这么做就能找到最小生成树。怎么证明呢？

## 几条概念

安全边：假定集合 A 是图 G 的（一条）最小生成树的子集。选择一条边 (u,v) ，将其加入到集合 A 中，如果加入后的集合 A 依然保证是 G 的最小生成树的子集，那称这次操作是安全的，边 (u,v) 是集合 A 的安全边。

切割：将图 G 中的顶点分为两个集合 S 和 V-S，则称这样的一个划分就是图 G 的一个切割。

横跨：对于一个切割（S，V-S）, 如果存在 G.E 中的一条边 (u,v)，它一个端点在集合 S 中，一个端点在集合 V-S 中，则称这条边横跨这个切割。

尊重：对于一个边的集合 A（子元素都是 G.E 里的），如果在它里面不存在横跨一个切割的边，则称这个切割尊重这个集合 A。也就是说，对于 A 中的边，它的两个端点要么都在 S 里，要么都在 V-S 里。

轻量级边：对于一个切割（S，V-S），在横跨这个切割的所有边里，权重最小的边称为轻量级边。当然，轻量级边可能不唯一。

## 定理及证明

Let `G = (V, E)` be a connected, undirected graph with a real-valued weight function `w` defined on `E`. Let `A` be a subset of `E` that is included in some minimum spanning tree for `G`, let `(S, V-S)` be any cut of `G` that respects `A`, and let `(u, v)` be a light edge crossing `(S, V-S)`. Then, edge `(u,v)` is safe for `A`.

设 G = (V,E)是一个在边 E 上定义了实数值权重函数 w 的连通无向图。设集合 A 是 E 的一个子集，且 A 包括在图 G 的某棵最小生成树中，设(S,V-S)是图 G 中尊重集合 A 的任意一个切割，又设(u,v)是横跨切割(S,V-S)的一条轻量级边。那么边(u,v)对于集合 A 来说是安全的。

证明：

设 T 是图 G 的一棵最小二叉树，并且包含边集 A，则由此知道 T 中的顶点将包括 G 中所有节点 V，T 中结点之间的边就完全都来自于 G 中的边 E，A 中所有节点和边都包含在 T 中。

先假设一条边(u,v)是横跨切割的一条轻量边。

1. 假设这条边包含在 T 中，则 A = A ∪ (u,v)之后的边集 A 也必然包含在 T 中，则按照上面安全边的定义，(u,v)对于 A 是安全的。

2. 如果这条边不包含在 T 中，则 T 是一棵最小生成树 => T 能连通所有的顶点 => T 能连通 u 和 v => u 和 v 之间有路径可以到达，而边(u,v)不在树 T 中，则一定存在从 u 出发，经过一系列其他点，然后到达 v 的路径 p，这条路径 p 和边(u,v)构成了一个环路。u 和 v 横跨切割，则 u 和 v 分别属于切割的两个集合，不妨以 u 在 S，v 在 V-S 为例。既然 u 和 v 在不同的集合里，且这两个集合是彼此不交的，那么路径 p 能连通 u 和 v，则路径 p 中一定有边跨越了两个集合 S 和 V-S，则这条边可以称做横跨切割(S,V-S)，不妨称这条边叫(x, y)，x 在集合 S 里，y 在集合 V-S 里。我们构建一条新的树 T'，令 T' = T - (x,y) + (u,v)。因为(u,v)是轻量边，而根据定义，必有 w(u,v) <= w(x,y)， 那么得出 w(T') <= w(T)。而 T 是一棵最小生成树，由 T 重新构建的树 T'也能连通所有的接点，并且 w(T') <= w(T)，那么 T'也一定是一棵最小生成树。切割(S,V-S)尊重集合 A，那么 A 中所有的边要么在 S 中，要么在 V-S 中，不会出现横跨的边，则边(x,y) 一定不属于集合 A。那么对于新集合 A = A ∪ (u,v)，可以将 T' = T - (x,y) + (u,v)进行拆分，T' = (A + 集合 B) - (x,y) + (u,v) = ( A + (u,v) ) + 集合 B - (x,y) ,由此新集合 A 仍然是某条最小生成树的子集，则证明(u,v)对于 A 是安全的。
